---
title: 验证码广告技术原理及攻防浅析
author: XDash
type: post
date: -001-11-30T00:00:00+00:00
draft: true
url: /?p=5106
views:
  - 3
categories:
  - Diary

---
验证码广告（Captcha Advertisement），又称输入式广告，它是以互联网验证码为载体，利用验证码的主动输入特性与互联网广告相结合的方式，将广告诉求传递给网络用户的一种全新概念的信息传播方式——以上摘录自百度百科。

一个用来理解的直观例子是，原本当用户泡坛子要填登录信息的时候，需要输入随机生成歪七扭八的四个字符如（FGFW），现在替换成预设的某个商家 brand/slogan（如Sprit）。于是同样一个输入动作，后者增强了用户对该品牌的印象，从而提高品牌的知名度或配合营销活动提升到达率。

验证码广告的好处在于：1）植入广告，发挥作用于无形，比显性的广告条悬浮窗更友好；2）不阻断用户当前操作；3）以输入的方式让品牌过脑，使广告内容更难被用户忽略；4）开发成本低（仅指开发验证码本身，运营层面的定制开发不在讨论范围）；5）验证码在眼下的互联网界属于必备功能，且短期内不会消亡。

本科阶段在网上看过一个关于各种变态验证码的搞笑帖子，遂在某堂营销课上突发奇想此种验证码广告形态，但那时候并不知道市场上暗涌着如此多的天使/VC/PE，于是这个想法就这样被雪藏了。后来国外估值上千亿的 SolveMedia 和国内融资百万的宇初网络验证了我的想法（也让我确信 set out to do 永远比空有伟大的 idea 更重要）。

抛开商业层面，我对验证码广告技术的实现原理及如何攻防（指用脚本来自动识别并填写验证码）也饶有兴趣，这里以简单的字符验证码广告为例分享一些最近了解的技术原理。

**一、如何实现验证码广告**

现在的 Web 前端 PHP 最为流行，而 PHP 中使用 GD 图像函数库能够很简单地生成验证码，核心函数就是 imagettftext() 。

这个函数的参数可以定义验证码字体的大小、角度、坐标、颜色。歪七扭八的验证字符就是靠它生成的。于是，启动 GD 函数绘制一张画布，在上面写上扭曲的验证字符，再随机生成一些噪点用于干扰自动识别机器即可。

而验证字符，就是广告商要求的brand/slogan文案，这写一个类似 Google Adwords 的管理后台提供给广告主/服务商/网站主进行配置。

**二、如何自动识别验证码**

最近刚好在研究 Python，看到一篇国外文章介绍如何通过 OCR 引擎来识别验证码的 Python 脚本，果然简洁（Life is too short, use Python.）。OCR 部分用现成的开源项目 PyTesser （<a href="http://code.google.com/p/pytesser/" target="_blank">Google Code 地址</a>）实现，剩下的就是对验证码部分的捕获和加工。

原文提供了 Python 源码，可以直接<a href="http://www.debasish.in/2012/01/bypass-captcha-using-python-and.html" target="_blank">点击这里</a>查看。写得很详尽。主要思路：诱发 PHP 脚本生成一个新的验证码图片作为当前有效验证 -> 保存该验证码图片到本地 -> 放大图片（提高图片可识别性） -> 增强图片对比度（有助于消灭噪点，突出字符） -> 保存为 TIF 格式丢给 PyTesser 识别。

三、针对广告图片的有限次数穷举破解构想

之前跟宇初网络也有过短暂的接触，了解到他们的验证码广告并非简单的字符验证码，而是可以根据广告主要求显示指定的广告图片。而用户在验证时需要根据广告图片中的提示去进行输入，如输入红色的字体/最大的字体/数字部分/英文部分，每次不同。

对广告主而言，为配合当季的广告 campaign，一般会提供特定尺寸、